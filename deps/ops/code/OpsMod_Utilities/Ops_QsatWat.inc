!-----------------------------------------------------------------------
! (C) Crown copyright Met Office. All rights reserved.
!     Refer to COPYRIGHT.txt of this distribution for details.
!-----------------------------------------------------------------------
! Saturation Specific Humidity Scheme: Vapour to Liquid.
!
! Returns a saturation mixing ratio given a temperature and pressure
! using saturation vapour pressure calculated using the Goff-Gratch
! Formulaie, adopted by the WMO as taken from Landolt-Bornstein, 1987
! Numerical Data and Functional Relationships in Science and
! Technology.  Group V/Vol 4B Meteorology.  Physical and Chemical
! Properties of Air, P35
!
! Values in the lookup table are over water above and below 0 degrees C.
!
! Note: For vapour pressure oever water this formula is valid for
! temperatures between 373K and 223K.  The values for saturated vapour
! over water in the lookup table below are out of the lower end of
! this range.  However it is standard WMO practice to use the formula
! below its accepted range for use with the calculation of dew points
! in the upper atmosphere
!
! Method:
!   Uses lookup tables to find eSAT, calculates qSAT directly from that.
!-----------------------------------------------------------------------

SUBROUTINE Ops_QsatWat (QS,    &
                        T,     &
                        P,     &
                        NPNTS)

USE GenMod_Core, ONLY: &
  gen_trace_entry,     &
  gen_trace_exit,      &
  UseTrace

USE GenMod_MiscUMScienceConstants, ONLY: &
  Epsilon,                               &
  ZeroDegC

IMPLICIT NONE

! Subroutine arguments:
INTEGER                     :: NPNTS     ! Points (=horizontal dimensions) being processed by qSAT scheme.
REAL                        :: T(NPNTS)  ! Temperature (K).
REAL                        :: P(NPNTS)  ! Pressure (Pa).
REAL                        :: QS(NPNTS) ! Saturation mixing ratio at temperature T and pressure P (KG/KG)

! Local declarations:
REAL, PARAMETER             :: ONE_MINUS_EPSILON = 1.0 - Epsilon
REAL, PARAMETER             :: T_LOW = 183.15
REAL, PARAMETER             :: T_HIGH = 338.15
REAL, PARAMETER             :: DELTA_T = 0.1
INTEGER, PARAMETER          :: N = ((T_HIGH - T_LOW + (DELTA_T * 0.5)) / DELTA_T) + 1.0  ! gives N = 1551
INTEGER                     :: ITABLE
REAL                        :: ATABLE
REAL                        :: FSUBW
REAL                        :: TT
INTEGER                     :: I
INTEGER                     :: IES
REAL                        :: ES(0:N + 1)   ! Table of saturation water vapour pressure (PA)
CHARACTER(len=*), PARAMETER :: RoutineName = "Ops_QsatWat"

! Note: 0 element is a repeat of 1st element to cater for special case
!       of low temperatures (.LE.T_LOW) for which the array index is
!       rounded down due to machine precision.

DATA (ES(IES),IES=    0, 95) / 0.186905E-01, &
0.186905E-01,0.190449E-01,0.194059E-01,0.197727E-01,0.201462E-01, &
0.205261E-01,0.209122E-01,0.213052E-01,0.217050E-01,0.221116E-01, &
0.225252E-01,0.229463E-01,0.233740E-01,0.238090E-01,0.242518E-01, &
0.247017E-01,0.251595E-01,0.256252E-01,0.260981E-01,0.265795E-01, &
0.270691E-01,0.275667E-01,0.280733E-01,0.285876E-01,0.291105E-01, &
0.296429E-01,0.301835E-01,0.307336E-01,0.312927E-01,0.318611E-01, &
0.324390E-01,0.330262E-01,0.336232E-01,0.342306E-01,0.348472E-01, &
0.354748E-01,0.361117E-01,0.367599E-01,0.374185E-01,0.380879E-01, &
0.387689E-01,0.394602E-01,0.401626E-01,0.408771E-01,0.416033E-01, &
0.423411E-01,0.430908E-01,0.438524E-01,0.446263E-01,0.454124E-01, &
0.462122E-01,0.470247E-01,0.478491E-01,0.486874E-01,0.495393E-01, &
0.504057E-01,0.512847E-01,0.521784E-01,0.530853E-01,0.540076E-01, &
0.549444E-01,0.558959E-01,0.568633E-01,0.578448E-01,0.588428E-01, &
0.598566E-01,0.608858E-01,0.619313E-01,0.629926E-01,0.640706E-01, &
0.651665E-01,0.662795E-01,0.674095E-01,0.685570E-01,0.697219E-01, &
0.709063E-01,0.721076E-01,0.733284E-01,0.745679E-01,0.758265E-01, &
0.771039E-01,0.784026E-01,0.797212E-01,0.810577E-01,0.824164E-01, &
0.837971E-01,0.851970E-01,0.866198E-01,0.880620E-01,0.895281E-01, &
0.910178E-01,0.925278E-01,0.940622E-01,0.956177E-01,0.971984E-01/
DATA (ES(IES),IES= 96,190) / &
0.988051E-01,0.100433E+00,0.102085E+00,0.103764E+00,0.105467E+00, &
0.107196E+00,0.108953E+00,0.110732E+00,0.112541E+00,0.114376E+00, &
0.116238E+00,0.118130E+00,0.120046E+00,0.121993E+00,0.123969E+00, &
0.125973E+00,0.128009E+00,0.130075E+00,0.132167E+00,0.134296E+00, &
0.136452E+00,0.138642E+00,0.140861E+00,0.143115E+00,0.145404E+00, &
0.147723E+00,0.150078E+00,0.152466E+00,0.154889E+00,0.157346E+00, &
0.159841E+00,0.162372E+00,0.164939E+00,0.167545E+00,0.170185E+00, &
0.172866E+00,0.175584E+00,0.178340E+00,0.181139E+00,0.183977E+00, &
0.186855E+00,0.189773E+00,0.192737E+00,0.195736E+00,0.198783E+00, &
0.201875E+00,0.205007E+00,0.208186E+00,0.211409E+00,0.214676E+00, &
0.217993E+00,0.221355E+00,0.224764E+00,0.228220E+00,0.231728E+00, &
0.235284E+00,0.238888E+00,0.242542E+00,0.246251E+00,0.250010E+00, &
0.253821E+00,0.257688E+00,0.261602E+00,0.265575E+00,0.269607E+00, &
0.273689E+00,0.277830E+00,0.282027E+00,0.286287E+00,0.290598E+00, &
0.294972E+00,0.299405E+00,0.303904E+00,0.308462E+00,0.313082E+00, &
0.317763E+00,0.322512E+00,0.327324E+00,0.332201E+00,0.337141E+00, &
0.342154E+00,0.347234E+00,0.352387E+00,0.357601E+00,0.362889E+00, &
0.368257E+00,0.373685E+00,0.379194E+00,0.384773E+00,0.390433E+00, &
0.396159E+00,0.401968E+00,0.407861E+00,0.413820E+00,0.419866E+00/
DATA (ES(IES),IES=191,285) / &
0.425999E+00,0.432203E+00,0.438494E+00,0.444867E+00,0.451332E+00, &
0.457879E+00,0.464510E+00,0.471226E+00,0.478037E+00,0.484935E+00, &
0.491920E+00,0.499005E+00,0.506181E+00,0.513447E+00,0.520816E+00, &
0.528279E+00,0.535835E+00,0.543497E+00,0.551256E+00,0.559113E+00, &
0.567081E+00,0.575147E+00,0.583315E+00,0.591585E+00,0.599970E+00, &
0.608472E+00,0.617069E+00,0.625785E+00,0.634609E+00,0.643556E+00, &
0.652611E+00,0.661782E+00,0.671077E+00,0.680487E+00,0.690015E+00, &
0.699656E+00,0.709433E+00,0.719344E+00,0.729363E+00,0.739518E+00, &
0.749795E+00,0.760217E+00,0.770763E+00,0.781454E+00,0.792258E+00, &
0.803208E+00,0.814309E+00,0.825528E+00,0.836914E+00,0.848422E+00, &
0.860086E+00,0.871891E+00,0.883837E+00,0.895944E+00,0.908214E+00, &
0.920611E+00,0.933175E+00,0.945890E+00,0.958776E+00,0.971812E+00, &
0.985027E+00,0.998379E+00,0.101193E+01,0.102561E+01,0.103949E+01, &
0.105352E+01,0.106774E+01,0.108213E+01,0.109669E+01,0.111144E+01, &
0.112636E+01,0.114148E+01,0.115676E+01,0.117226E+01,0.118791E+01, &
0.120377E+01,0.121984E+01,0.123608E+01,0.125252E+01,0.126919E+01, &
0.128604E+01,0.130309E+01,0.132036E+01,0.133782E+01,0.135549E+01, &
0.137339E+01,0.139150E+01,0.140984E+01,0.142839E+01,0.144715E+01, &
0.146616E+01,0.148538E+01,0.150482E+01,0.152450E+01,0.154445E+01/
DATA (ES(IES),IES=286,380) / &
0.156459E+01,0.158502E+01,0.160564E+01,0.162654E+01,0.164766E+01, &
0.166906E+01,0.169070E+01,0.171257E+01,0.173473E+01,0.175718E+01, &
0.177984E+01,0.180282E+01,0.182602E+01,0.184951E+01,0.187327E+01, &
0.189733E+01,0.192165E+01,0.194629E+01,0.197118E+01,0.199636E+01, &
0.202185E+01,0.204762E+01,0.207372E+01,0.210010E+01,0.212678E+01, &
0.215379E+01,0.218109E+01,0.220873E+01,0.223668E+01,0.226497E+01, &
0.229357E+01,0.232249E+01,0.235176E+01,0.238134E+01,0.241129E+01, &
0.244157E+01,0.247217E+01,0.250316E+01,0.253447E+01,0.256617E+01, &
0.259821E+01,0.263064E+01,0.266341E+01,0.269661E+01,0.273009E+01, &
0.276403E+01,0.279834E+01,0.283302E+01,0.286811E+01,0.290358E+01, &
0.293943E+01,0.297571E+01,0.301236E+01,0.304946E+01,0.308702E+01, &
0.312491E+01,0.316326E+01,0.320208E+01,0.324130E+01,0.328092E+01, &
0.332102E+01,0.336162E+01,0.340264E+01,0.344407E+01,0.348601E+01, &
0.352838E+01,0.357118E+01,0.361449E+01,0.365834E+01,0.370264E+01, &
0.374737E+01,0.379265E+01,0.383839E+01,0.388469E+01,0.393144E+01, &
0.397876E+01,0.402656E+01,0.407492E+01,0.412378E+01,0.417313E+01, &
0.422306E+01,0.427359E+01,0.432454E+01,0.437617E+01,0.442834E+01, &
0.448102E+01,0.453433E+01,0.458816E+01,0.464253E+01,0.469764E+01, &
0.475321E+01,0.480942E+01,0.486629E+01,0.492372E+01,0.498173E+01/
DATA (ES(IES),IES=381,475) / &
0.504041E+01,0.509967E+01,0.515962E+01,0.522029E+01,0.528142E+01, &
0.534337E+01,0.540595E+01,0.546912E+01,0.553292E+01,0.559757E+01, &
0.566273E+01,0.572864E+01,0.579532E+01,0.586266E+01,0.593075E+01, &
0.599952E+01,0.606895E+01,0.613918E+01,0.621021E+01,0.628191E+01, &
0.635433E+01,0.642755E+01,0.650162E+01,0.657639E+01,0.665188E+01, &
0.672823E+01,0.680532E+01,0.688329E+01,0.696198E+01,0.704157E+01, &
0.712206E+01,0.720319E+01,0.728534E+01,0.736829E+01,0.745204E+01, &
0.753671E+01,0.762218E+01,0.770860E+01,0.779588E+01,0.788408E+01, &
0.797314E+01,0.806318E+01,0.815408E+01,0.824599E+01,0.833874E+01, &
0.843254E+01,0.852721E+01,0.862293E+01,0.871954E+01,0.881724E+01, &
0.891579E+01,0.901547E+01,0.911624E+01,0.921778E+01,0.932061E+01, &
0.942438E+01,0.952910E+01,0.963497E+01,0.974181E+01,0.984982E+01, &
0.995887E+01,0.100690E+02,0.101804E+02,0.102926E+02,0.104063E+02, &
0.105210E+02,0.106367E+02,0.107536E+02,0.108719E+02,0.109912E+02, &
0.111116E+02,0.112333E+02,0.113563E+02,0.114804E+02,0.116056E+02, &
0.117325E+02,0.118602E+02,0.119892E+02,0.121197E+02,0.122513E+02, &
0.123844E+02,0.125186E+02,0.126543E+02,0.127912E+02,0.129295E+02, &
0.130691E+02,0.132101E+02,0.133527E+02,0.134965E+02,0.136415E+02, &
0.137882E+02,0.139361E+02,0.140855E+02,0.142366E+02,0.143889E+02/
DATA (ES(IES),IES=476,570) / &
0.145429E+02,0.146982E+02,0.148552E+02,0.150135E+02,0.151735E+02, &
0.153349E+02,0.154979E+02,0.156624E+02,0.158286E+02,0.159965E+02, &
0.161659E+02,0.163367E+02,0.165094E+02,0.166838E+02,0.168597E+02, &
0.170375E+02,0.172168E+02,0.173979E+02,0.175806E+02,0.177651E+02, &
0.179513E+02,0.181394E+02,0.183293E+02,0.185210E+02,0.187146E+02, &
0.189098E+02,0.191066E+02,0.193059E+02,0.195065E+02,0.197095E+02, &
0.199142E+02,0.201206E+02,0.203291E+02,0.205397E+02,0.207522E+02, &
0.209664E+02,0.211831E+02,0.214013E+02,0.216221E+02,0.218448E+02, &
0.220692E+02,0.222959E+02,0.225250E+02,0.227559E+02,0.229887E+02, &
0.232239E+02,0.234614E+02,0.237014E+02,0.239428E+02,0.241872E+02, &
0.244335E+02,0.246824E+02,0.249332E+02,0.251860E+02,0.254419E+02, &
0.256993E+02,0.259600E+02,0.262225E+02,0.264873E+02,0.267552E+02, &
0.270248E+02,0.272970E+02,0.275719E+02,0.278497E+02,0.281295E+02, &
0.284117E+02,0.286965E+02,0.289843E+02,0.292743E+02,0.295671E+02, &
0.298624E+02,0.301605E+02,0.304616E+02,0.307650E+02,0.310708E+02, &
0.313803E+02,0.316915E+02,0.320064E+02,0.323238E+02,0.326437E+02, &
0.329666E+02,0.332928E+02,0.336215E+02,0.339534E+02,0.342885E+02, &
0.346263E+02,0.349666E+02,0.353109E+02,0.356572E+02,0.360076E+02, &
0.363606E+02,0.367164E+02,0.370757E+02,0.374383E+02,0.378038E+02/
DATA (ES(IES),IES=571,665) / &
0.381727E+02,0.385453E+02,0.389206E+02,0.392989E+02,0.396807E+02, &
0.400663E+02,0.404555E+02,0.408478E+02,0.412428E+02,0.416417E+02, &
0.420445E+02,0.424502E+02,0.428600E+02,0.432733E+02,0.436900E+02, &
0.441106E+02,0.445343E+02,0.449620E+02,0.453930E+02,0.458280E+02, &
0.462672E+02,0.467096E+02,0.471561E+02,0.476070E+02,0.480610E+02, &
0.485186E+02,0.489813E+02,0.494474E+02,0.499170E+02,0.503909E+02, &
0.508693E+02,0.513511E+02,0.518376E+02,0.523277E+02,0.528232E+02, &
0.533213E+02,0.538240E+02,0.543315E+02,0.548437E+02,0.553596E+02, &
0.558802E+02,0.564046E+02,0.569340E+02,0.574672E+02,0.580061E+02, &
0.585481E+02,0.590963E+02,0.596482E+02,0.602041E+02,0.607649E+02, &
0.613311E+02,0.619025E+02,0.624779E+02,0.630574E+02,0.636422E+02, &
0.642324E+02,0.648280E+02,0.654278E+02,0.660332E+02,0.666426E+02, &
0.672577E+02,0.678771E+02,0.685034E+02,0.691328E+02,0.697694E+02, &
0.704103E+02,0.710556E+02,0.717081E+02,0.723639E+02,0.730269E+02, &
0.736945E+02,0.743681E+02,0.750463E+02,0.757309E+02,0.764214E+02, &
0.771167E+02,0.778182E+02,0.785246E+02,0.792373E+02,0.799564E+02, &
0.806804E+02,0.814109E+02,0.821479E+02,0.828898E+02,0.836384E+02, &
0.843922E+02,0.851525E+02,0.859198E+02,0.866920E+02,0.874712E+02, &
0.882574E+02,0.890486E+02,0.898470E+02,0.906525E+02,0.914634E+02/
DATA (ES(IES),IES=666,760) / &
0.922814E+02,0.931048E+02,0.939356E+02,0.947736E+02,0.956171E+02, &
0.964681E+02,0.973246E+02,0.981907E+02,0.990605E+02,0.999399E+02, &
0.100825E+03,0.101718E+03,0.102617E+03,0.103523E+03,0.104438E+03, &
0.105358E+03,0.106287E+03,0.107221E+03,0.108166E+03,0.109115E+03, &
0.110074E+03,0.111039E+03,0.112012E+03,0.112992E+03,0.113981E+03, &
0.114978E+03,0.115981E+03,0.116993E+03,0.118013E+03,0.119041E+03, &
0.120077E+03,0.121122E+03,0.122173E+03,0.123234E+03,0.124301E+03, &
0.125377E+03,0.126463E+03,0.127556E+03,0.128657E+03,0.129769E+03, &
0.130889E+03,0.132017E+03,0.133152E+03,0.134299E+03,0.135453E+03, &
0.136614E+03,0.137786E+03,0.138967E+03,0.140158E+03,0.141356E+03, &
0.142565E+03,0.143781E+03,0.145010E+03,0.146247E+03,0.147491E+03, &
0.148746E+03,0.150011E+03,0.151284E+03,0.152571E+03,0.153862E+03, &
0.155168E+03,0.156481E+03,0.157805E+03,0.159137E+03,0.160478E+03, &
0.161832E+03,0.163198E+03,0.164569E+03,0.165958E+03,0.167348E+03, &
0.168757E+03,0.170174E+03,0.171599E+03,0.173037E+03,0.174483E+03, &
0.175944E+03,0.177414E+03,0.178892E+03,0.180387E+03,0.181886E+03, &
0.183402E+03,0.184930E+03,0.186463E+03,0.188012E+03,0.189571E+03, &
0.191146E+03,0.192730E+03,0.194320E+03,0.195930E+03,0.197546E+03, &
0.199175E+03,0.200821E+03,0.202473E+03,0.204142E+03,0.205817E+03/
DATA (ES(IES),IES=761,855) / &
0.207510E+03,0.209216E+03,0.210928E+03,0.212658E+03,0.214398E+03, &
0.216152E+03,0.217920E+03,0.219698E+03,0.221495E+03,0.223297E+03, &
0.225119E+03,0.226951E+03,0.228793E+03,0.230654E+03,0.232522E+03, &
0.234413E+03,0.236311E+03,0.238223E+03,0.240151E+03,0.242090E+03, &
0.244049E+03,0.246019E+03,0.248000E+03,0.249996E+03,0.252009E+03, &
0.254037E+03,0.256077E+03,0.258128E+03,0.260200E+03,0.262284E+03, &
0.264384E+03,0.266500E+03,0.268629E+03,0.270779E+03,0.272936E+03, &
0.275110E+03,0.277306E+03,0.279509E+03,0.281734E+03,0.283966E+03, &
0.286227E+03,0.288494E+03,0.290780E+03,0.293083E+03,0.295398E+03, &
0.297737E+03,0.300089E+03,0.302453E+03,0.304841E+03,0.307237E+03, &
0.309656E+03,0.312095E+03,0.314541E+03,0.317012E+03,0.319496E+03, &
0.322005E+03,0.324527E+03,0.327063E+03,0.329618E+03,0.332193E+03, &
0.334788E+03,0.337396E+03,0.340025E+03,0.342673E+03,0.345329E+03, &
0.348019E+03,0.350722E+03,0.353440E+03,0.356178E+03,0.358938E+03, &
0.361718E+03,0.364513E+03,0.367322E+03,0.370160E+03,0.373012E+03, &
0.375885E+03,0.378788E+03,0.381691E+03,0.384631E+03,0.387579E+03, &
0.390556E+03,0.393556E+03,0.396563E+03,0.399601E+03,0.402646E+03, &
0.405730E+03,0.408829E+03,0.411944E+03,0.415083E+03,0.418236E+03, &
0.421422E+03,0.424632E+03,0.427849E+03,0.431099E+03,0.434365E+03/
DATA (ES(IES),IES=856,950) / &
0.437655E+03,0.440970E+03,0.444301E+03,0.447666E+03,0.451038E+03, &
0.454445E+03,0.457876E+03,0.461316E+03,0.464790E+03,0.468281E+03, &
0.471798E+03,0.475342E+03,0.478902E+03,0.482497E+03,0.486101E+03, &
0.489741E+03,0.493408E+03,0.497083E+03,0.500804E+03,0.504524E+03, &
0.508290E+03,0.512074E+03,0.515877E+03,0.519717E+03,0.523566E+03, &
0.527462E+03,0.531367E+03,0.535301E+03,0.539264E+03,0.543245E+03, &
0.547265E+03,0.551305E+03,0.555363E+03,0.559462E+03,0.563579E+03, &
0.567727E+03,0.571905E+03,0.576102E+03,0.580329E+03,0.584576E+03, &
0.588865E+03,0.593185E+03,0.597514E+03,0.601885E+03,0.606276E+03, &
0.610699E+03,0.615151E+03,0.619625E+03,0.624140E+03,0.628671E+03, &
0.633243E+03,0.637845E+03,0.642465E+03,0.647126E+03,0.651806E+03, &
0.656527E+03,0.661279E+03,0.666049E+03,0.670861E+03,0.675692E+03, &
0.680566E+03,0.685471E+03,0.690396E+03,0.695363E+03,0.700350E+03, &
0.705381E+03,0.710444E+03,0.715527E+03,0.720654E+03,0.725801E+03, &
0.730994E+03,0.736219E+03,0.741465E+03,0.746756E+03,0.752068E+03, &
0.757426E+03,0.762819E+03,0.768231E+03,0.773692E+03,0.779172E+03, &
0.784701E+03,0.790265E+03,0.795849E+03,0.801483E+03,0.807137E+03, &
0.812842E+03,0.818582E+03,0.824343E+03,0.830153E+03,0.835987E+03, &
0.841871E+03,0.847791E+03,0.853733E+03,0.859727E+03,0.865743E+03/
DATA (ES(IES),IES=951,1045) / &
0.871812E+03,0.877918E+03,0.884046E+03,0.890228E+03,0.896433E+03, &
0.902690E+03,0.908987E+03,0.915307E+03,0.921681E+03,0.928078E+03, &
0.934531E+03,0.941023E+03,0.947539E+03,0.954112E+03,0.960708E+03, &
0.967361E+03,0.974053E+03,0.980771E+03,0.987545E+03,0.994345E+03, &
0.100120E+04,0.100810E+04,0.101502E+04,0.102201E+04,0.102902E+04, &
0.103608E+04,0.104320E+04,0.105033E+04,0.105753E+04,0.106475E+04, &
0.107204E+04,0.107936E+04,0.108672E+04,0.109414E+04,0.110158E+04, &
0.110908E+04,0.111663E+04,0.112421E+04,0.113185E+04,0.113952E+04, &
0.114725E+04,0.115503E+04,0.116284E+04,0.117071E+04,0.117861E+04, &
0.118658E+04,0.119459E+04,0.120264E+04,0.121074E+04,0.121888E+04, &
0.122709E+04,0.123534E+04,0.124362E+04,0.125198E+04,0.126036E+04, &
0.126881E+04,0.127731E+04,0.128584E+04,0.129444E+04,0.130307E+04, &
0.131177E+04,0.132053E+04,0.132931E+04,0.133817E+04,0.134705E+04, &
0.135602E+04,0.136503E+04,0.137407E+04,0.138319E+04,0.139234E+04, &
0.140156E+04,0.141084E+04,0.142015E+04,0.142954E+04,0.143896E+04, &
0.144845E+04,0.145800E+04,0.146759E+04,0.147725E+04,0.148694E+04, &
0.149672E+04,0.150655E+04,0.151641E+04,0.152635E+04,0.153633E+04, &
0.154639E+04,0.155650E+04,0.156665E+04,0.157688E+04,0.158715E+04, &
0.159750E+04,0.160791E+04,0.161836E+04,0.162888E+04,0.163945E+04/
DATA (ES(IES),IES=1046,1140) / &
0.165010E+04,0.166081E+04,0.167155E+04,0.168238E+04,0.169325E+04, &
0.170420E+04,0.171522E+04,0.172627E+04,0.173741E+04,0.174859E+04, &
0.175986E+04,0.177119E+04,0.178256E+04,0.179402E+04,0.180552E+04, &
0.181711E+04,0.182877E+04,0.184046E+04,0.185224E+04,0.186407E+04, &
0.187599E+04,0.188797E+04,0.190000E+04,0.191212E+04,0.192428E+04, &
0.193653E+04,0.194886E+04,0.196122E+04,0.197368E+04,0.198618E+04, &
0.199878E+04,0.201145E+04,0.202416E+04,0.203698E+04,0.204983E+04, &
0.206278E+04,0.207580E+04,0.208887E+04,0.210204E+04,0.211525E+04, &
0.212856E+04,0.214195E+04,0.215538E+04,0.216892E+04,0.218249E+04, &
0.219618E+04,0.220994E+04,0.222375E+04,0.223766E+04,0.225161E+04, &
0.226567E+04,0.227981E+04,0.229399E+04,0.230829E+04,0.232263E+04, &
0.233708E+04,0.235161E+04,0.236618E+04,0.238087E+04,0.239560E+04, &
0.241044E+04,0.242538E+04,0.244035E+04,0.245544E+04,0.247057E+04, &
0.248583E+04,0.250116E+04,0.251654E+04,0.253204E+04,0.254759E+04, &
0.256325E+04,0.257901E+04,0.259480E+04,0.261073E+04,0.262670E+04, &
0.264279E+04,0.265896E+04,0.267519E+04,0.269154E+04,0.270794E+04, &
0.272447E+04,0.274108E+04,0.275774E+04,0.277453E+04,0.279137E+04, &
0.280834E+04,0.282540E+04,0.284251E+04,0.285975E+04,0.287704E+04, &
0.289446E+04,0.291198E+04,0.292954E+04,0.294725E+04,0.296499E+04/
DATA (ES(IES),IES=1141,1235) / &
0.298288E+04,0.300087E+04,0.301890E+04,0.303707E+04,0.305529E+04, &
0.307365E+04,0.309211E+04,0.311062E+04,0.312927E+04,0.314798E+04, &
0.316682E+04,0.318577E+04,0.320477E+04,0.322391E+04,0.324310E+04, &
0.326245E+04,0.328189E+04,0.330138E+04,0.332103E+04,0.334073E+04, &
0.336058E+04,0.338053E+04,0.340054E+04,0.342069E+04,0.344090E+04, &
0.346127E+04,0.348174E+04,0.350227E+04,0.352295E+04,0.354369E+04, &
0.356458E+04,0.358559E+04,0.360664E+04,0.362787E+04,0.364914E+04, &
0.367058E+04,0.369212E+04,0.371373E+04,0.373548E+04,0.375731E+04, &
0.377929E+04,0.380139E+04,0.382355E+04,0.384588E+04,0.386826E+04, &
0.389081E+04,0.391348E+04,0.393620E+04,0.395910E+04,0.398205E+04, &
0.400518E+04,0.402843E+04,0.405173E+04,0.407520E+04,0.409875E+04, &
0.412246E+04,0.414630E+04,0.417019E+04,0.419427E+04,0.421840E+04, &
0.424272E+04,0.426715E+04,0.429165E+04,0.431634E+04,0.434108E+04, &
0.436602E+04,0.439107E+04,0.441618E+04,0.444149E+04,0.446685E+04, &
0.449241E+04,0.451810E+04,0.454385E+04,0.456977E+04,0.459578E+04, &
0.462197E+04,0.464830E+04,0.467468E+04,0.470127E+04,0.472792E+04, &
0.475477E+04,0.478175E+04,0.480880E+04,0.483605E+04,0.486336E+04, &
0.489087E+04,0.491853E+04,0.494623E+04,0.497415E+04,0.500215E+04, &
0.503034E+04,0.505867E+04,0.508707E+04,0.511568E+04,0.514436E+04/
DATA (ES(IES),IES=1236,1330) / &
0.517325E+04,0.520227E+04,0.523137E+04,0.526068E+04,0.529005E+04, &
0.531965E+04,0.534939E+04,0.537921E+04,0.540923E+04,0.543932E+04, &
0.546965E+04,0.550011E+04,0.553064E+04,0.556139E+04,0.559223E+04, &
0.562329E+04,0.565449E+04,0.568577E+04,0.571727E+04,0.574884E+04, &
0.578064E+04,0.581261E+04,0.584464E+04,0.587692E+04,0.590924E+04, &
0.594182E+04,0.597455E+04,0.600736E+04,0.604039E+04,0.607350E+04, &
0.610685E+04,0.614036E+04,0.617394E+04,0.620777E+04,0.624169E+04, &
0.627584E+04,0.631014E+04,0.634454E+04,0.637918E+04,0.641390E+04, &
0.644887E+04,0.648400E+04,0.651919E+04,0.655467E+04,0.659021E+04, &
0.662599E+04,0.666197E+04,0.669800E+04,0.673429E+04,0.677069E+04, &
0.680735E+04,0.684415E+04,0.688104E+04,0.691819E+04,0.695543E+04, &
0.699292E+04,0.703061E+04,0.706837E+04,0.710639E+04,0.714451E+04, &
0.718289E+04,0.722143E+04,0.726009E+04,0.729903E+04,0.733802E+04, &
0.737729E+04,0.741676E+04,0.745631E+04,0.749612E+04,0.753602E+04, &
0.757622E+04,0.761659E+04,0.765705E+04,0.769780E+04,0.773863E+04, &
0.777975E+04,0.782106E+04,0.786246E+04,0.790412E+04,0.794593E+04, &
0.798802E+04,0.803028E+04,0.807259E+04,0.811525E+04,0.815798E+04, &
0.820102E+04,0.824427E+04,0.828757E+04,0.833120E+04,0.837493E+04, &
0.841895E+04,0.846313E+04,0.850744E+04,0.855208E+04,0.859678E+04/
DATA (ES(IES),IES=1331,1425) / &
0.864179E+04,0.868705E+04,0.873237E+04,0.877800E+04,0.882374E+04, &
0.886979E+04,0.891603E+04,0.896237E+04,0.900904E+04,0.905579E+04, &
0.910288E+04,0.915018E+04,0.919758E+04,0.924529E+04,0.929310E+04, &
0.934122E+04,0.938959E+04,0.943804E+04,0.948687E+04,0.953575E+04, &
0.958494E+04,0.963442E+04,0.968395E+04,0.973384E+04,0.978383E+04, &
0.983412E+04,0.988468E+04,0.993534E+04,0.998630E+04,0.100374E+05, &
0.100888E+05,0.101406E+05,0.101923E+05,0.102444E+05,0.102966E+05, &
0.103492E+05,0.104020E+05,0.104550E+05,0.105082E+05,0.105616E+05, &
0.106153E+05,0.106693E+05,0.107234E+05,0.107779E+05,0.108325E+05, &
0.108874E+05,0.109425E+05,0.109978E+05,0.110535E+05,0.111092E+05, &
0.111653E+05,0.112217E+05,0.112782E+05,0.113350E+05,0.113920E+05, &
0.114493E+05,0.115070E+05,0.115646E+05,0.116228E+05,0.116809E+05, &
0.117396E+05,0.117984E+05,0.118574E+05,0.119167E+05,0.119762E+05, &
0.120360E+05,0.120962E+05,0.121564E+05,0.122170E+05,0.122778E+05, &
0.123389E+05,0.124004E+05,0.124619E+05,0.125238E+05,0.125859E+05, &
0.126484E+05,0.127111E+05,0.127739E+05,0.128372E+05,0.129006E+05, &
0.129644E+05,0.130285E+05,0.130927E+05,0.131573E+05,0.132220E+05, &
0.132872E+05,0.133526E+05,0.134182E+05,0.134842E+05,0.135503E+05, &
0.136168E+05,0.136836E+05,0.137505E+05,0.138180E+05,0.138854E+05/
DATA (ES(IES),IES=1426,1520) / &
0.139534E+05,0.140216E+05,0.140900E+05,0.141588E+05,0.142277E+05, &
0.142971E+05,0.143668E+05,0.144366E+05,0.145069E+05,0.145773E+05, &
0.146481E+05,0.147192E+05,0.147905E+05,0.148622E+05,0.149341E+05, &
0.150064E+05,0.150790E+05,0.151517E+05,0.152250E+05,0.152983E+05, &
0.153721E+05,0.154462E+05,0.155205E+05,0.155952E+05,0.156701E+05, &
0.157454E+05,0.158211E+05,0.158969E+05,0.159732E+05,0.160496E+05, &
0.161265E+05,0.162037E+05,0.162811E+05,0.163589E+05,0.164369E+05, &
0.165154E+05,0.165942E+05,0.166732E+05,0.167526E+05,0.168322E+05, &
0.169123E+05,0.169927E+05,0.170733E+05,0.171543E+05,0.172356E+05, &
0.173173E+05,0.173993E+05,0.174815E+05,0.175643E+05,0.176471E+05, &
0.177305E+05,0.178143E+05,0.178981E+05,0.179826E+05,0.180671E+05, &
0.181522E+05,0.182377E+05,0.183232E+05,0.184093E+05,0.184955E+05, &
0.185823E+05,0.186695E+05,0.187568E+05,0.188447E+05,0.189326E+05, &
0.190212E+05,0.191101E+05,0.191991E+05,0.192887E+05,0.193785E+05, &
0.194688E+05,0.195595E+05,0.196503E+05,0.197417E+05,0.198332E+05, &
0.199253E+05,0.200178E+05,0.201105E+05,0.202036E+05,0.202971E+05, &
0.203910E+05,0.204853E+05,0.205798E+05,0.206749E+05,0.207701E+05, &
0.208659E+05,0.209621E+05,0.210584E+05,0.211554E+05,0.212524E+05, &
0.213501E+05,0.214482E+05,0.215465E+05,0.216452E+05,0.217442E+05/
DATA (ES(IES),IES=1521,1552) / &
0.218439E+05,0.219439E+05,0.220440E+05,0.221449E+05,0.222457E+05, &
0.223473E+05,0.224494E+05,0.225514E+05,0.226542E+05,0.227571E+05, &
0.228606E+05,0.229646E+05,0.230687E+05,0.231734E+05,0.232783E+05, &
0.233839E+05,0.234898E+05,0.235960E+05,0.237027E+05,0.238097E+05, &
0.239173E+05,0.240254E+05,0.241335E+05,0.242424E+05,0.243514E+05, &
0.244611E+05,0.245712E+05,0.246814E+05,0.247923E+05,0.249034E+05, &
0.250152E+05,0.250152E+05/

IF (UseTrace) CALL gen_trace_entry (RoutineName)

DO I = 1, NPNTS

  ! Compute the factor that converts from sat vapour pressure in a
  ! pure water system to sat vapour pressure in air, FSUBW.  This formula
  ! is taken from equation A4.7 of Adrian Gill's Book: Atmosphere-Ocean
  ! Dynamics.  Note that his formula works in terms of pressure in MB and
  ! temperature in Celsius, so conversion of units leads to the slightly
  ! different equation used here.

  FSUBW = 1.0 + 1.0E-8 * P(I) * (4.5 + 6.0E-4 * (T(I) - ZERODEGC) * (T(I) - ZERODEGC))

  ! Use the lookup table to find saturated vapour pressure, and store it in QS

  TT = MAX (T_LOW, T(I))
  TT = MIN (T_HIGH, TT)

  ATABLE = (TT - T_LOW + DELTA_T) / DELTA_T
  ITABLE = ATABLE
  ATABLE = ATABLE - ITABLE

  QS(I) = (1.0 - ATABLE) * ES(ITABLE) + ATABLE * ES(ITABLE + 1)

  ! Multiple by FSUBW to convert to saturated vapour pressure in air
  ! (equation A4.6 of Adrian Gill's book)

  QS(I) = QS(I) * FSUBW

  ! Now form the accurate expression for QS, which is a rearranged version of
  ! equation A4.3 of Gill's book.
  !
  ! Note that at very low pressures we apply a fix, to prevent a singularity
  ! (Qsat tends to 1.0 kg/kg)

  QS(I) = (EPSILON * QS(I)) / (MAX (P(I), QS(I)) - ONE_MINUS_EPSILON * QS(I))

END DO

IF (UseTrace) CALL gen_trace_exit (RoutineName)

END SUBROUTINE Ops_QsatWat
